language: php

php:
  - 5.5.9

env:
  - DB=mysql

before_script:
  - echo 'yes' | pecl install mailparse 
  - echo 'extension = mbstring.so' >> ~/.phpenv/versions/$(phpenv version-name)/etc/php.ini
  - echo 'extension = mcrypt.so' >> ~/.phpenv/versions/$(phpenv version-name)/etc/php.ini
  - mysql -e 'CREATE DATABASE `abuseio.travis`;'
  - travis_retry composer self-update
  - travis_retry composer install --prefer-source --no-interaction --dev
  - chmod -R 777 app/storage
  - php artisan migrate:install --no-interaction -vvv
  - php artisan db:seed
  - chmod +x extra/notifier-samples/runall; extra/notifier-samples/runall

script: 
  - vendor/bin/phpunit

after_script:
  - ls -laR app/storage
  - cat app/storage/logs/*

notifications:
  email:
    - bart@abuse.io
  irc:
    channels:
      - "irc.freenode.net##abuseio"
    template:
      - "%{repository}#%{build_number} (%{branch} - %{commit}) %{author}: %{message} - %{build_url}"
  on_failure: always
  on_success: change
